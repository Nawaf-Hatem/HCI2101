<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù„Ø¹Ø¨Ø© XO - ØªÙŠÙƒ ØªØ§Ùƒ ØªÙˆ</title>

  <style>
    :root{
      --bg1:#0b1220;
      --bg2:#0a1b2f;
      --card: rgba(255,255,255,.08);
      --card2: rgba(255,255,255,.12);
      --border: rgba(255,255,255,.18);
      --text:#eaf2ff;
      --muted: rgba(234,242,255,.7);
      --x:#7CFFCB;
      --o:#FF7AA2;
      --accent:#7AA7FF;
      --shadow: 0 18px 60px rgba(0,0,0,.35);
      --radius: 20px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial;
      color: var(--text);
      min-height: 100vh;
      display:flex;
      flex-direction:column;
      background:
        radial-gradient(1200px 600px at 10% 10%, rgba(122,167,255,.25), transparent 60%),
        radial-gradient(900px 500px at 90% 30%, rgba(255,122,162,.18), transparent 55%),
        radial-gradient(900px 600px at 50% 100%, rgba(124,255,203,.14), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
    }

    .container{
      width:min(980px, 92vw);
      margin: 28px auto 18px;
      flex:1;
      display:grid;
      gap:18px;
      grid-template-columns: 1.1fr .9fr;
      align-items:start;
    }

    @media (max-width: 860px){
      .container{ grid-template-columns: 1fr; }
    }

    header{
      grid-column: 1 / -1;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      padding: 18px 18px;
      border:1px solid var(--border);
      border-radius: var(--radius);
      background: linear-gradient(180deg, var(--card), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
    }

    header::before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(600px 120px at 10% 0%, rgba(124,255,203,.25), transparent 60%),
        radial-gradient(500px 120px at 90% 0%, rgba(255,122,162,.22), transparent 60%);
      filter: blur(10px);
      opacity:.9;
      pointer-events:none;
    }

    header > *{ position:relative; z-index:1; }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
    }

    .logo{
      width:44px;height:44px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.2);
      background:
        radial-gradient(circle at 30% 20%, rgba(124,255,203,.8), transparent 55%),
        radial-gradient(circle at 70% 80%, rgba(255,122,162,.75), transparent 55%),
        rgba(255,255,255,.08);
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      display:grid;
      place-items:center;
      font-weight:800;
    }

    .brand h1{
      margin:0;
      font-size: 18px;
      letter-spacing:.2px;
    }
    .brand p{
      margin:0;
      font-size: 12px;
      color: var(--muted);
    }

    .header-actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .btn{
      cursor:pointer;
      border:none;
      color: var(--text);
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.14);
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 700;
      transition:.2s;
      display:inline-flex;
      align-items:center;
      gap:8px;
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.14); }
    .btn:active{ transform: translateY(0px); }

    .btn.primary{
      background: linear-gradient(180deg, rgba(122,167,255,.28), rgba(122,167,255,.12));
      border-color: rgba(122,167,255,.35);
    }

    .btn.danger{
      background: linear-gradient(180deg, rgba(255,122,162,.26), rgba(255,122,162,.10));
      border-color: rgba(255,122,162,.32);
    }

    .panel{
      border:1px solid var(--border);
      border-radius: var(--radius);
      background: linear-gradient(180deg, var(--card), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      padding: 16px;
      position:relative;
      overflow:hidden;
    }

    .panel-title{
      margin:0 0 10px;
      font-size: 14px;
      color: var(--muted);
    }

    /* Board */
    .board-wrap{
      display:flex;
      flex-direction:column;
      gap: 12px;
    }

    .status{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }

    .pill{
      display:inline-flex;
      gap:10px;
      align-items:center;
      padding: 10px 12px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      font-weight: 800;
      font-size: 13px;
    }

    .turn-dot{
      width:10px;height:10px;border-radius:50%;
      background: var(--accent);
      box-shadow: 0 0 0 6px rgba(122,167,255,.10);
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      padding: 10px;
      border-radius: 22px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.12);
    }

    .cell{
      height: 118px;
      border:none;
      border-radius: 20px;
      border:1px solid rgba(255,255,255,.14);
      background:
        radial-gradient(220px 80px at 20% 10%, rgba(255,255,255,.10), transparent 55%),
        rgba(255,255,255,.06);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.08);
      color: var(--text);
      font-size: 52px;
      font-weight: 900;
      cursor:pointer;
      transition:.18s;
      position:relative;
      overflow:hidden;
    }

    .cell:hover{ transform: translateY(-2px); border-color: rgba(255,255,255,.22); }
    .cell:active{ transform: translateY(0px); }
    .cell[disabled]{ cursor:not-allowed; opacity:.95; }
    .cell.win{
      outline: 2px solid rgba(124,255,203,.6);
      box-shadow: 0 0 0 8px rgba(124,255,203,.12), inset 0 0 0 1px rgba(0,0,0,.1);
      transform: translateY(-1px);
    }

    .cell.x{ color: var(--x); text-shadow: 0 12px 30px rgba(124,255,203,.25); }
    .cell.o{ color: var(--o); text-shadow: 0 12px 30px rgba(255,122,162,.22); }

    /* Side panel */
    .score{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 8px;
    }

    .score-box{
      padding: 14px 14px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.07);
    }
    .score-box h3{
      margin:0 0 6px;
      font-size: 13px;
      color: var(--muted);
      font-weight: 900;
    }
    .score-box .num{
      font-size: 26px;
      font-weight: 1000;
    }

    .settings{
      display:flex;
      flex-direction:column;
      gap: 10px;
      margin-top: 14px;
    }

    .row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      padding: 12px 12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
    }
    .row label{
      font-weight: 900;
      font-size: 13px;
      color: var(--text);
    }
    .row span{
      font-size: 12px;
      color: var(--muted);
    }

    select{
      border-radius: 14px;
      padding: 10px 12px;
      background: rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.18);
      color: var(--text);
      outline:none;
      font-weight: 800;
    }

    .note{
      margin-top: 12px;
      color: var(--muted);
      font-size: 12px;
      line-height:1.7;
    }

    /* Modal */
    .modal{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
      z-index: 999;
      padding: 18px;
    }

    .modal.show{ display:flex; }

    .modal-card{
      width: min(520px, 96vw);
      border-radius: 22px;
      border:1px solid rgba(255,255,255,.16);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      box-shadow: 0 30px 90px rgba(0,0,0,.45);
      overflow:hidden;
    }

    .modal-head{
      padding: 14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      border-bottom:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.16);
    }

    .modal-head strong{ font-size: 14px; }
    .modal-body{
      padding: 18px 16px;
      color: var(--text);
      line-height:1.9;
      font-weight:800;
    }

    footer{
      width:min(980px, 92vw);
      margin: 0 auto 20px;
      padding: 12px 14px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(234,242,255,.8);
      font-size: 13px;
      text-align:center;
    }

    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.22);
      padding: 1px 6px;
      border-radius: 10px;
      font-size: 12px;
    }
  </style>
</head>

<body>

  <div class="container">

    <header>
      <div class="brand">
        <div class="logo">XO</div>
        <div>
          <h1>Ù„Ø¹Ø¨Ø© XO Ø§Ù„Ø­Ø¯ÙŠØ«Ø©</h1>
          <p>ÙˆØ§Ø¬Ù‡Ø© Ø¹Ø±Ø¨ÙŠØ© â€¢ ØªØµÙ…ÙŠÙ… Ø¹ØµØ±ÙŠ â€¢ Ù„Ø§Ø¹Ø¨ Ø¶Ø¯ Ù„Ø§Ø¹Ø¨ Ø£Ùˆ Ø¶Ø¯ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±</p>
        </div>
      </div>

      <div class="header-actions">
        <button class="btn primary" id="newRoundBtn">ğŸ® Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
        <button class="btn danger" id="resetBtn">ğŸ§¹ ØªØµÙÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
      </div>
    </header>

    <!-- BOARD -->
    <section class="panel board-wrap">
      <p class="panel-title">Ø§Ù„Ù„ÙˆØ­Ø©</p>

      <div class="status">
        <div class="pill" id="statusPill">
          <span class="turn-dot" id="turnDot"></span>
          <span id="statusText">Ø¯ÙˆØ± Ø§Ù„Ù„Ø§Ø¹Ø¨: X</span>
        </div>

        <div class="pill">
          <span style="color:rgba(234,242,255,.85)">Ø§Ø®ØªØµØ§Ø±Ø§Øª:</span>
          <span class="kbd">N</span> Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©
          <span class="kbd">R</span> ØªØµÙÙŠØ±
        </div>
      </div>

      <div class="grid" id="grid">
        <button class="cell" data-i="0" aria-label="Ø®Ø§Ù†Ø© 1"></button>
        <button class="cell" data-i="1" aria-label="Ø®Ø§Ù†Ø© 2"></button>
        <button class="cell" data-i="2" aria-label="Ø®Ø§Ù†Ø© 3"></button>
        <button class="cell" data-i="3" aria-label="Ø®Ø§Ù†Ø© 4"></button>
        <button class="cell" data-i="4" aria-label="Ø®Ø§Ù†Ø© 5"></button>
        <button class="cell" data-i="5" aria-label="Ø®Ø§Ù†Ø© 6"></button>
        <button class="cell" data-i="6" aria-label="Ø®Ø§Ù†Ø© 7"></button>
        <button class="cell" data-i="7" aria-label="Ø®Ø§Ù†Ø© 8"></button>
        <button class="cell" data-i="8" aria-label="Ø®Ø§Ù†Ø© 9"></button>
      </div>

    </section>

    <!-- SIDE -->
    <aside class="panel">
      <p class="panel-title">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª + Ø§Ù„Ù†ØªØ§Ø¦Ø¬</p>

      <div class="score">
        <div class="score-box">
          <h3>ÙÙˆØ² Ø§Ù„Ù„Ø§Ø¹Ø¨ X</h3>
          <div class="num" id="xWins">0</div>
        </div>
        <div class="score-box">
          <h3>ÙÙˆØ² Ø§Ù„Ù„Ø§Ø¹Ø¨ O</h3>
          <div class="num" id="oWins">0</div>
        </div>
        <div class="score-box">
          <h3>Ø§Ù„ØªØ¹Ø§Ø¯Ù„Ø§Øª</h3>
          <div class="num" id="ties">0</div>
        </div>
        <div class="score-box">
          <h3>Ø§Ù„Ø¬ÙˆÙ„Ø§Øª</h3>
          <div class="num" id="rounds">1</div>
        </div>
      </div>

      <div class="settings">
        <div class="row">
          <div>
            <label>ÙˆØ¶Ø¹ Ø§Ù„Ù„Ø¹Ø¨</label>
            <div><span>Ø§Ø®ØªØ±: Ù„Ø§Ø¹Ø¨ Ø¶Ø¯ Ù„Ø§Ø¹Ø¨ Ø£Ùˆ Ø¶Ø¯ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±</span></div>
          </div>
          <select id="modeSelect" aria-label="ÙˆØ¶Ø¹ Ø§Ù„Ù„Ø¹Ø¨">
            <option value="pvp">Ù„Ø§Ø¹Ø¨ Ø¶Ø¯ Ù„Ø§Ø¹Ø¨</option>
            <option value="ai">Ù„Ø§Ø¹Ø¨ Ø¶Ø¯ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±</option>
          </select>
        </div>

        <div class="row">
          <div>
            <label>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±</label>
            <div><span>ÙŠØªÙØ¹Ù„ ÙÙ‚Ø· ÙÙŠ ÙˆØ¶Ø¹ Ø¶Ø¯ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±</span></div>
          </div>
          <select id="aiSelect" aria-label="Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±">
            <option value="easy">Ø³Ù‡Ù„</option>
            <option value="medium" selected>Ù…ØªÙˆØ³Ø·</option>
            <option value="hard">ØµØ¹Ø¨ (Minimax)</option>
          </select>
        </div>

        <div class="row">
          <div>
            <label>Ù…Ù† ÙŠØ¨Ø¯Ø£</label>
            <div><span>ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© ÙƒÙ„ Ø¬ÙˆÙ„Ø©</span></div>
          </div>
          <select id="starterSelect" aria-label="Ù…Ù† ÙŠØ¨Ø¯Ø£">
            <option value="X" selected>Ø§Ù„Ù„Ø§Ø¹Ø¨ X</option>
            <option value="O">Ø§Ù„Ù„Ø§Ø¹Ø¨ O</option>
          </select>
        </div>
      </div>

      <p class="note">
        âœ” ØªØµÙ…ÙŠÙ… Ø­Ø¯ÙŠØ« ÙˆÙ…Ø±ØªØ¨<br/>
        âœ” ØªØ£Ø«ÙŠØ±Ø§Øª ÙÙˆØ² Ø¬Ù…ÙŠÙ„Ø©<br/>
        âœ” Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ (Ø³Ù‡Ù„/Ù…ØªÙˆØ³Ø·/ØµØ¹Ø¨)<br/>
        âœ” Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙØ­Ø©<br/>
      </p>
    </aside>

  </div>

  <footer>
    Student Name: Nawaf] | ID: [446002013] | Supervised by: Mohammed Jabal
  </footer>

  <!-- MODAL -->
  <div class="modal" id="modal">
    <div class="modal-card">
      <div class="modal-head">
        <strong id="modalTitle">Ø§Ù„Ù†ØªÙŠØ¬Ø©</strong>
        <button class="btn" id="closeModalBtn">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
      <div class="modal-body" id="modalBody"></div>
    </div>
  </div>

  <script>
    // ===== Helpers =====
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));

    const cells = $$(".cell");
    const statusText = $("#statusText");
    const turnDot = $("#turnDot");
    const modeSelect = $("#modeSelect");
    const aiSelect = $("#aiSelect");
    const starterSelect = $("#starterSelect");

    const xWinsEl = $("#xWins");
    const oWinsEl = $("#oWins");
    const tiesEl  = $("#ties");
    const roundsEl = $("#rounds");

    const modal = $("#modal");
    const modalTitle = $("#modalTitle");
    const modalBody = $("#modalBody");

    const winLines = [
      [0,1,2],[3,4,5],[6,7,8],
      [0,3,6],[1,4,7],[2,5,8],
      [0,4,8],[2,4,6]
    ];

    let board = Array(9).fill("");
    let current = "X";
    let gameOver = false;

    // Score
    let score = {
      X: 0,
      O: 0,
      ties: 0,
      rounds: 1,
    };

    function setStatus(text, color="var(--accent)"){
      statusText.textContent = text;
      turnDot.style.background = color;
      turnDot.style.boxShadow = `0 0 0 6px rgba(122,167,255,.10)`;
    }

    function openModal(title, body){
      modalTitle.textContent = title;
      modalBody.innerHTML = body;
      modal.classList.add("show");
    }

    function closeModal(){
      modal.classList.remove("show");
    }

    $("#closeModalBtn").addEventListener("click", closeModal);
    modal.addEventListener("click", (e)=>{
      if(e.target === modal) closeModal();
    });

    function render(){
      for(let i=0;i<9;i++){
        const v = board[i];
        cells[i].textContent = v;
        cells[i].classList.toggle("x", v==="X");
        cells[i].classList.toggle("o", v==="O");
        cells[i].disabled = gameOver || v !== "";
      }

      xWinsEl.textContent = score.X;
      oWinsEl.textContent = score.O;
      tiesEl.textContent = score.ties;
      roundsEl.textContent = score.rounds;

      // status
      if(!gameOver){
        const color = current === "X" ? "var(--x)" : "var(--o)";
        setStatus(`Ø¯ÙˆØ± Ø§Ù„Ù„Ø§Ø¹Ø¨: ${current}`, color);
      }
    }

    function clearWinEffects(){
      cells.forEach(c => c.classList.remove("win"));
    }

    function checkWinner(b = board){
      for(const line of winLines){
        const [a,c,d] = line;
        if(b[a] && b[a] === b[c] && b[a] === b[d]){
          return { winner: b[a], line };
        }
      }
      if(b.every(x => x !== "")) return { winner: "tie", line: null };
      return null;
    }

    function endGame(result){
      gameOver = true;

      if(result.winner === "tie"){
        score.ties++;
        openModal("ØªØ¹Ø§Ø¯Ù„ ğŸ¤", "Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬ÙˆÙ„Ø© Ø¨Ø§Ù„ØªØ¹Ø§Ø¯Ù„!<br><br>Ø§Ø¶ØºØ· <b>Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©</b> Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©.");
        setStatus("ØªØ¹Ø§Ø¯Ù„!", "var(--accent)");
      }else{
        score[result.winner]++;
        const w = result.winner;
        const line = result.line || [];
        line.forEach(i => cells[i].classList.add("win"));

        const color = w === "X" ? "var(--x)" : "var(--o)";
        setStatus(`Ø§Ù„ÙØ§Ø¦Ø²: ${w} ğŸ‰`, color);

        openModal("ÙÙˆØ² ğŸ‰", `Ù…Ø¨Ø±ÙˆÙƒ! Ø§Ù„Ù„Ø§Ø¹Ø¨ <b style="color:${w==='X'?'var(--x)':'var(--o)'}">${w}</b> ÙØ§Ø² ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¬ÙˆÙ„Ø©.`);
      }

      render();
    }

    function switchTurn(){
      current = current === "X" ? "O" : "X";
    }

    function validMoves(b = board){
      return b.map((v,i)=> v==="" ? i : null).filter(v=>v!==null);
    }

    // ===== AI =====
    function aiSymbol(){
      // AI always plays "O" for simplicity
      return "O";
    }

    function humanSymbol(){
      return "X";
    }

    function aiMoveEasy(){
      const moves = validMoves();
      return moves[Math.floor(Math.random()*moves.length)];
    }

    function aiMoveMedium(){
      // 1) win if possible
      // 2) block human win
      // 3) take center
      // 4) random
      const ai = aiSymbol();
      const hu = humanSymbol();
      const moves = validMoves();

      // win
      for(const m of moves){
        const b = board.slice();
        b[m] = ai;
        const res = checkWinner(b);
        if(res && res.winner === ai) return m;
      }

      // block
      for(const m of moves){
        const b = board.slice();
        b[m] = hu;
        const res = checkWinner(b);
        if(res && res.winner === hu) return m;
      }

      if(board[4] === "") return 4;
      return moves[Math.floor(Math.random()*moves.length)];
    }

    function minimax(b, isMaximizing){
      const res = checkWinner(b);
      if(res){
        if(res.winner === aiSymbol()) return { score: 10 };
        if(res.winner === humanSymbol()) return { score: -10 };
        return { score: 0 };
      }

      const moves = validMoves(b);

      if(isMaximizing){
        let best = { score: -Infinity, move: null };
        for(const m of moves){
          const nb = b.slice();
          nb[m] = aiSymbol();
          const evalRes = minimax(nb, false);
          const value = evalRes.score - 0.1; // prefer quicker wins
          if(value > best.score){
            best = { score: value, move: m };
          }
        }
        return best;
      }else{
        let best = { score: Infinity, move: null };
        for(const m of moves){
          const nb = b.slice();
          nb[m] = humanSymbol();
          const evalRes = minimax(nb, true);
          const value = evalRes.score + 0.1; // prefer delaying losses
          if(value < best.score){
            best = { score: value, move: m };
          }
        }
        return best;
      }
    }

    function aiMoveHard(){
      const best = minimax(board.slice(), true);
      return best.move ?? aiMoveMedium();
    }

    function computeAiMove(){
      const level = aiSelect.value;
      if(level === "easy") return aiMoveEasy();
      if(level === "medium") return aiMoveMedium();
      return aiMoveHard();
    }

    function maybeAiTurn(){
      if(modeSelect.value !== "ai") return;
      if(gameOver) return;

      // AI plays as "O"
      if(current !== "O") return;

      // delay for animation feel
      setStatus("Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± ÙŠÙÙƒØ±... ğŸ¤–", "var(--o)");
      cells.forEach(c => c.disabled = true);

      setTimeout(()=>{
        const move = computeAiMove();
        if(move == null) return;

        board[move] = "O";
        const res = checkWinner();
        if(res) endGame(res);
        else{
          switchTurn();
          render();
        }
      }, 550);
    }

    // ===== Gameplay =====
    function playAt(i){
      if(gameOver) return;
      if(board[i] !== "") return;

      // In AI mode, human is X and must play only when current = X
      if(modeSelect.value === "ai" && current !== humanSymbol()) return;

      board[i] = current;
      const res = checkWinner();
      if(res){
        endGame(res);
        return;
      }

      switchTurn();
      render();
      maybeAiTurn();
    }

    cells.forEach(cell=>{
      cell.addEventListener("click", ()=>{
        const i = Number(cell.dataset.i);
        playAt(i);
      });
    });

    // New Round
    function newRound(){
      clearWinEffects();
      board = Array(9).fill("");
      gameOver = false;

      // starter
      current = starterSelect.value;
      score.rounds++;

      render();
      maybeAiTurn();
    }

    // Reset Scores
    function resetAll(){
      score = { X:0, O:0, ties:0, rounds:1 };
      starterSelect.value = "X";
      modeSelect.value = "pvp";
      aiSelect.value = "medium";
      clearWinEffects();

      board = Array(9).fill("");
      current = "X";
      gameOver = false;

      render();
      openModal("ØªÙ… Ø§Ù„ØªØµÙÙŠØ± âœ…", "ØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…Ù† Ø¬Ø¯ÙŠØ¯.");
    }

    // Buttons
    $("#newRoundBtn").addEventListener("click", ()=>{
      // do not increment rounds if it's first load? â€” keep consistent
      newRound();
    });

    $("#resetBtn").addEventListener("click", resetAll);

    // Settings change
    modeSelect.addEventListener("change", ()=>{
      // ensure in AI mode: human=X, ai=O
      if(modeSelect.value === "ai"){
        // if starter selected O, AI will start
        openModal("ÙˆØ¶Ø¹ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± ğŸ¤–", "Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± ÙŠÙ„Ø¹Ø¨ Ø¨Ù€ <b style='color:var(--o)'>O</b>ØŒ ÙˆØ£Ù†Øª ØªÙ„Ø¹Ø¨ Ø¨Ù€ <b style='color:var(--x)'>X</b>.");
      }
      // start fresh board when mode changes
      clearWinEffects();
      board = Array(9).fill("");
      current = starterSelect.value;
      gameOver = false;
      render();
      maybeAiTurn();
    });

    aiSelect.addEventListener("change", ()=>{
      if(modeSelect.value === "ai"){
        openModal("ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø³ØªÙˆÙ‰", `Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± Ø§Ù„Ø¢Ù†: <b>${aiSelect.options[aiSelect.selectedIndex].text}</b>`);
      }
    });

    starterSelect.addEventListener("change", ()=>{
      // just start new clean round without changing score of wins
      clearWinEffects();
      board = Array(9).fill("");
      current = starterSelect.value;
      gameOver = false;
      render();
      maybeAiTurn();
    });

    // Keyboard shortcuts
    document.addEventListener("keydown", (e)=>{
      const k = e.key.toLowerCase();
      if(k === "n") newRound();
      if(k === "r") resetAll();
      if(k === "escape") closeModal();
    });

    // first render
    render();
  </script>
</body>
</html>