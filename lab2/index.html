<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù„Ø¹Ø¨Ø© XO Ø§Ù„Ø­Ø¯ÙŠØ«Ø© - ÙˆØ§Ø¬Ù‡Ø© Ø¹Ø±Ø¨ÙŠØ©</title>
  <style>
    :root{
      --bg1:#07121f;
      --bg2:#081a33;
      --card: rgba(255,255,255,.08);
      --card2: rgba(255,255,255,.12);
      --border: rgba(255,255,255,.18);
      --text:#eef5ff;
      --muted: rgba(238,245,255,.72);

      --x:#7CFFCB;
      --o:#FF7AA2;
      --accent:#7AA7FF;

      --shadow: 0 18px 60px rgba(0,0,0,.38);
      --radius: 20px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial;
      color: var(--text);
      min-height: 100vh;
      display:flex;
      flex-direction:column;
      background:
        radial-gradient(1200px 700px at 12% 10%, rgba(122,167,255,.22), transparent 60%),
        radial-gradient(1000px 650px at 90% 30%, rgba(255,122,162,.16), transparent 55%),
        radial-gradient(900px 650px at 50% 100%, rgba(124,255,203,.12), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
    }

    /* Layout wrapper */
    .app{
      width:min(980px, 92vw);
      margin: 26px auto 14px;
      flex:1;
      display:flex;
      flex-direction:column;
      gap:16px;
    }

    /* Header */
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      padding: 16px 16px;
      border:1px solid var(--border);
      border-radius: var(--radius);
      background: linear-gradient(180deg, var(--card), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
    }
    header::before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(620px 140px at 10% 0%, rgba(124,255,203,.22), transparent 60%),
        radial-gradient(520px 140px at 90% 0%, rgba(255,122,162,.20), transparent 60%);
      filter: blur(12px);
      opacity:.9;
      pointer-events:none;
    }
    header > *{ position:relative; z-index:1; }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
    }
    .logo{
      width:44px;height:44px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.2);
      background:
        radial-gradient(circle at 30% 20%, rgba(124,255,203,.75), transparent 55%),
        radial-gradient(circle at 70% 80%, rgba(255,122,162,.70), transparent 55%),
        rgba(255,255,255,.08);
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      display:grid;
      place-items:center;
      font-weight:1000;
      letter-spacing:.5px;
    }
    .brand h1{
      margin:0;
      font-size: 18px;
      letter-spacing:.2px;
    }
    .brand p{
      margin:0;
      font-size: 12px;
      color: var(--muted);
      line-height:1.6;
    }

    .header-actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .btn{
      cursor:pointer;
      border:none;
      color: var(--text);
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.14);
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 900;
      transition:.2s;
      display:inline-flex;
      align-items:center;
      gap:8px;
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.14); }
    .btn:active{ transform: translateY(0px); }

    .btn.primary{
      background: linear-gradient(180deg, rgba(122,167,255,.28), rgba(122,167,255,.12));
      border-color: rgba(122,167,255,.35);
    }
    .btn.danger{
      background: linear-gradient(180deg, rgba(255,122,162,.26), rgba(255,122,162,.10));
      border-color: rgba(255,122,162,.32);
    }

    /* Panels */
    .grid2{
      display:grid;
      gap:16px;
      grid-template-columns: 1.1fr .9fr;
      align-items:start;
    }
    @media (max-width: 860px){
      .grid2{ grid-template-columns: 1fr; }
    }

    .panel{
      border:1px solid var(--border);
      border-radius: var(--radius);
      background: linear-gradient(180deg, var(--card), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      padding: 16px;
      position:relative;
      overflow:hidden;
    }
    .panel-title{
      margin:0 0 10px;
      font-size: 13px;
      color: var(--muted);
      font-weight: 900;
    }

    /* Start screen overlay */
    .start-screen{
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
      z-index: 999;
      padding: 18px;
    }

    .start-card{
      width:min(720px, 96vw);
      border-radius: 24px;
      border:1px solid rgba(255,255,255,.16);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      box-shadow: 0 30px 90px rgba(0,0,0,.50);
      overflow:hidden;
    }

    .start-head{
      padding: 14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      border-bottom:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.16);
    }
    .start-head strong{
      font-size: 14px;
      letter-spacing:.2px;
    }

    .start-body{
      padding: 16px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }
    @media (max-width: 760px){
      .start-body{ grid-template-columns: 1fr; }
    }

    .card-block{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      border-radius: 18px;
      padding: 14px;
    }
    .card-block h2{
      margin:0 0 8px;
      font-size: 15px;
    }
    .card-block p{
      margin:0 0 10px;
      color: var(--muted);
      font-size: 12px;
      line-height:1.7;
    }

    .field{
      display:flex;
      flex-direction:column;
      gap: 8px;
      margin-top: 10px;
    }
    .field label{
      font-weight: 900;
      font-size: 12px;
      color: rgba(238,245,255,.85);
    }
    input, select{
      border-radius: 14px;
      padding: 11px 12px;
      background: rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.18);
      color: var(--text);
      outline:none;
      font-weight: 800;
    }

    .start-actions{
      padding: 14px 16px;
      border-top:1px solid rgba(255,255,255,.12);
      display:flex;
      gap:10px;
      justify-content:flex-start;
      flex-wrap:wrap;
      background: rgba(0,0,0,.12);
    }

    /* Board */
    .board-wrap{
      display:flex;
      flex-direction:column;
      gap: 12px;
    }
    .status{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .pill{
      display:inline-flex;
      gap:10px;
      align-items:center;
      padding: 10px 12px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      font-weight: 1000;
      font-size: 13px;
    }
    .turn-dot{
      width:10px;height:10px;border-radius:50%;
      background: var(--accent);
      box-shadow: 0 0 0 6px rgba(122,167,255,.10);
    }
    .board{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      padding: 10px;
      border-radius: 22px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.12);
    }
    .cell{
      height: 118px;
      border:none;
      border-radius: 20px;
      border:1px solid rgba(255,255,255,.14);
      background:
        radial-gradient(220px 80px at 20% 10%, rgba(255,255,255,.10), transparent 55%),
        rgba(255,255,255,.06);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.08);
      color: var(--text);
      font-size: 52px;
      font-weight: 1000;
      cursor:pointer;
      transition:.18s;
      position:relative;
      overflow:hidden;
      user-select:none;
    }
    .cell:hover{ transform: translateY(-2px); border-color: rgba(255,255,255,.22); }
    .cell:active{ transform: translateY(0px); }
    .cell[disabled]{ cursor:not-allowed; opacity:.95; }

    .cell.x{ color: var(--x); text-shadow: 0 12px 30px rgba(124,255,203,.25); }
    .cell.o{ color: var(--o); text-shadow: 0 12px 30px rgba(255,122,162,.22); }
    .cell.win{
      outline: 2px solid rgba(124,255,203,.6);
      box-shadow: 0 0 0 8px rgba(124,255,203,.12), inset 0 0 0 1px rgba(0,0,0,.1);
      transform: translateY(-1px);
    }

    /* Side panel */
    .score{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 8px;
    }
    .score-box{
      padding: 14px 14px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.07);
    }
    .score-box h3{
      margin:0 0 6px;
      font-size: 12px;
      color: var(--muted);
      font-weight: 1000;
    }
    .score-box .num{
      font-size: 26px;
      font-weight: 1000;
    }

    .rows{
      display:flex;
      flex-direction:column;
      gap: 10px;
      margin-top: 14px;
    }
    .row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      padding: 12px 12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
    }
    .row .meta{
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .row label{
      font-weight: 1000;
      font-size: 13px;
      color: var(--text);
    }
    .row span{
      font-size: 12px;
      color: var(--muted);
      line-height:1.5;
    }

    .note{
      margin-top: 12px;
      color: var(--muted);
      font-size: 12px;
      line-height:1.7;
    }

    /* Toast */
    .toast{
      position: fixed;
      bottom: 92px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,.55);
      border: 1px solid rgba(255,255,255,.18);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 999px;
      box-shadow: 0 18px 50px rgba(0,0,0,.45);
      backdrop-filter: blur(10px);
      z-index: 1200;
      opacity: 0;
      pointer-events: none;
      transition: .22s;
      font-weight: 900;
      text-align:center;
      max-width: 92vw;
    }
    .toast.show{ opacity: 1; }

    /* Footer - mandatory persistent bottom */
    footer{
      width: 100%;
      position: sticky;
      bottom: 0;
      margin-top: auto;
      padding: 12px 10px;
      background: rgba(0,0,0,.30);
      border-top: 1px solid rgba(255,255,255,.14);
      color: rgba(238,245,255,.84);
      font-size: 13px;
      text-align:center;
      backdrop-filter: blur(10px);
    }

    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.22);
      padding: 1px 6px;
      border-radius: 10px;
      font-size: 12px;
      font-weight: 900;
    }
  </style>
</head>

<body>

  <!-- START SCREEN (names + mode) -->
  <div class="start-screen" id="startScreen" aria-modal="true" role="dialog">
    <div class="start-card">
      <div class="start-head">
        <strong>Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø© ğŸ®</strong>
        <span style="color:var(--muted); font-weight:900; font-size:12px">ÙˆØ§Ø¬Ù‡Ø© Ø¹Ø±Ø¨ÙŠØ© â€¢ ØªØµÙ…ÙŠÙ… Ø­Ø¯ÙŠØ«</span>
      </div>

      <div class="start-body">
        <div class="card-block">
          <h2>Ø§Ø®ØªÙŠØ§Ø± ÙˆØ¶Ø¹ Ø§Ù„Ù„Ø¹Ø¨</h2>
          <p>Ø§Ø®ØªØ± Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù„Ø¹Ø¨ Ø¨Ù…ÙØ±Ø¯Ùƒ Ø¶Ø¯ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± Ø£Ùˆ Ø§Ù„Ù„Ø¹Ø¨ Ù…Ø¹ ØµØ¯ÙŠÙ‚ (Ù„Ø§Ø¹Ø¨ÙŠÙ†).</p>

          <div class="field">
            <label for="modeSelect">ÙˆØ¶Ø¹ Ø§Ù„Ù„Ø¹Ø¨</label>
            <select id="modeSelect">
              <option value="single">Ù„Ø§Ø¹Ø¨ ÙˆØ§Ø­Ø¯ (Ø¶Ø¯ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±)</option>
              <option value="two">Ù„Ø§Ø¹Ø¨ÙŠÙ† (Ø¶Ø¯ Ù„Ø§Ø¹Ø¨)</option>
            </select>
          </div>

          <div class="field">
            <label for="starterSelect">Ù…Ù† ÙŠØ¨Ø¯Ø£ Ø§Ù„Ø¬ÙˆÙ„Ø©ØŸ</label>
            <select id="starterSelect">
              <option value="X" selected>Ø§Ù„Ù„Ø§Ø¹Ø¨ X</option>
              <option value="O">Ø§Ù„Ù„Ø§Ø¹Ø¨ O</option>
            </select>
          </div>

          <div class="field">
            <label for="aiSelect">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±</label>
            <select id="aiSelect">
              <option value="easy">Ø³Ù‡Ù„</option>
              <option value="medium" selected>Ù…ØªÙˆØ³Ø·</option>
              <option value="hard">ØµØ¹Ø¨ (Ø°ÙƒÙŠ)</option>
            </select>
          </div>
        </div>

        <div class="card-block">
          <h2>Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</h2>
          <p>Ø§ÙƒØªØ¨ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ (Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ø§Ø¹Ø¨ ÙˆØ§Ø­Ø¯ØŒ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø«Ø§Ù†ÙŠ ÙŠØµØ¨Ø­ "Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±").</p>

          <div class="field">
            <label for="p1Name">Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø£ÙˆÙ„ (X)</label>
            <input id="p1Name" type="text" placeholder="Ù…Ø«Ø§Ù„: Ù†ÙˆØ§Ù" maxlength="18" />
          </div>

          <div class="field">
            <label for="p2Name">Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø«Ø§Ù†ÙŠ (O)</label>
            <input id="p2Name" type="text" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø­Ù…Ø¯" maxlength="18" />
          </div>

          <p style="margin:10px 0 0; color:var(--muted); font-size:12px; line-height:1.7">
            Ø§Ø®ØªØµØ§Ø±Ø§Øª: <span class="kbd">N</span> Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø© â€¢ <span class="kbd">R</span> ØªØµÙÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ â€¢ <span class="kbd">Esc</span> Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
          </p>
        </div>
      </div>

      <div class="start-actions">
        <button class="btn primary" id="startBtn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù† âœ…</button>
        <button class="btn" id="fillDemoBtn">ØªØ¹Ø¨Ø¦Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© âœ¨</button>
      </div>
    </div>
  </div>

  <div class="app">
    <header>
      <div class="brand">
        <div class="logo">XO</div>
        <div>
          <h1>Ù„Ø¹Ø¨Ø© XO Ø§Ù„Ø­Ø¯ÙŠØ«Ø©</h1>
          <p id="subTitle">Ø§Ø®ØªØ± ÙˆØ¶Ø¹ Ø§Ù„Ù„Ø¹Ø¨ Ù…Ù† Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</p>
        </div>
      </div>

      <div class="header-actions">
        <button class="btn primary" id="newRoundBtn">ğŸ® Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
        <button class="btn danger" id="resetBtn">ğŸ§¹ ØªØµÙÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
      </div>
    </header>

    <div class="grid2">

      <!-- BOARD -->
      <section class="panel board-wrap">
        <p class="panel-title">Ø§Ù„Ù„ÙˆØ­Ø©</p>

        <div class="status">
          <div class="pill">
            <span class="turn-dot" id="turnDot"></span>
            <span id="statusText">Ø¬Ø§Ù‡Ø²</span>
          </div>

          <div class="pill" id="playersPill">
            Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ†: <span id="playersText">â€”</span>
          </div>
        </div>

        <div class="board" id="board">
          <button class="cell" data-i="0" aria-label="Ø®Ø§Ù†Ø© 1"></button>
          <button class="cell" data-i="1" aria-label="Ø®Ø§Ù†Ø© 2"></button>
          <button class="cell" data-i="2" aria-label="Ø®Ø§Ù†Ø© 3"></button>
          <button class="cell" data-i="3" aria-label="Ø®Ø§Ù†Ø© 4"></button>
          <button class="cell" data-i="4" aria-label="Ø®Ø§Ù†Ø© 5"></button>
          <button class="cell" data-i="5" aria-label="Ø®Ø§Ù†Ø© 6"></button>
          <button class="cell" data-i="6" aria-label="Ø®Ø§Ù†Ø© 7"></button>
          <button class="cell" data-i="7" aria-label="Ø®Ø§Ù†Ø© 8"></button>
          <button class="cell" data-i="8" aria-label="Ø®Ø§Ù†Ø© 9"></button>
        </div>

        <p class="note">
          <b>ÙƒÙŠÙÙŠØ© Ø§Ù„Ù„Ø¹Ø¨:</b> Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ Ø®Ø§Ù†Ø© Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø±Ù…Ø². Ø£ÙˆÙ„ Ù…Ù† ÙŠÙƒÙˆÙ‘Ù† 3 Ù…ØªØªØ§Ù„ÙŠØ© ÙŠÙÙˆØ².
        </p>
      </section>

      <!-- SIDE -->
      <aside class="panel">
        <p class="panel-title">Ø§Ù„Ù†ØªØ§Ø¦Ø¬ + Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</p>

        <div class="score">
          <div class="score-box">
            <h3 id="xLabel">ÙÙˆØ² X</h3>
            <div class="num" id="xWins">0</div>
          </div>
          <div class="score-box">
            <h3 id="oLabel">ÙÙˆØ² O</h3>
            <div class="num" id="oWins">0</div>
          </div>
          <div class="score-box">
            <h3>Ø§Ù„ØªØ¹Ø§Ø¯Ù„Ø§Øª</h3>
            <div class="num" id="ties">0</div>
          </div>
          <div class="score-box">
            <h3>Ø¹Ø¯Ø¯ Ø§Ù„Ø¬ÙˆÙ„Ø§Øª</h3>
            <div class="num" id="rounds">0</div>
          </div>
        </div>

        <div class="rows">
          <div class="row">
            <div class="meta">
              <label>ÙˆØ¶Ø¹ Ø§Ù„Ù„Ø¹Ø¨</label>
              <span id="modeInfo">â€”</span>
            </div>
            <button class="btn" id="changeModeBtn">ØªØºÙŠÙŠØ±</button>
          </div>

          <div class="row">
            <div class="meta">
              <label>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±</label>
              <span id="aiInfo">â€”</span>
            </div>
            <button class="btn" id="aiQuickBtn">ØªØ¨Ø¯ÙŠÙ„</button>
          </div>

          <div class="row">
            <div class="meta">
              <label>Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠ</label>
              <span id="turnInfo">â€”</span>
            </div>
            <button class="btn" id="hintBtn">ØªÙ„Ù…ÙŠØ­ âœ¨</button>
          </div>
        </div>

        <p class="note">
          âœ… ØªØµÙ…ÙŠÙ… Ø¹ØµØ±ÙŠ ÙˆÙ…ØªØ¬Ø§ÙˆØ¨ (Ù…ÙˆØ¨Ø§ÙŠÙ„/ÙƒÙ…Ø¨ÙŠÙˆØªØ±)<br/>
          âœ… Ø´Ø§Ø´Ø© Ø¨Ø¯Ø§ÙŠØ© Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†<br/>
          âœ… Ø¯Ø¹Ù… Ù„Ø§Ø¹Ø¨ ÙˆØ§Ø­Ø¯ (Ø¶Ø¯ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±) Ø£Ùˆ Ù„Ø§Ø¹Ø¨ÙŠÙ†<br/>
          âœ… ØªÙ„Ù…ÙŠØ­ Ø°ÙƒÙŠ Ø¨Ø³ÙŠØ· (Ø¨Ø¯ÙˆÙ† ÙƒØ´Ù ÙƒØ§Ù…Ù„ Ù„Ù„Ø­Ù„)
        </p>
      </aside>

    </div>
  </div>

  <div class="toast" id="toast"></div>

  <!-- Mandatory persistent footer -->
  <footer>
    Student Name: NAWAF HATEM HAMID ALSAAEDY (Ù†ÙˆØ§Ù Ø­Ø§ØªÙ… Ø­Ù…ÙŠØ¯ Ø§Ù„ØµØ§Ø¹Ø¯ÙŠ) |
    Student ID: 446002013 |
    Supervised by: Mohammed Ahmed Jabali
  </footer>

  <script>
    // ===== Utilities =====
    const $ = (s) => document.querySelector(s);
    const $$ = (s) => Array.from(document.querySelectorAll(s));

    const toastEl = $("#toast");
    let toastTimer = null;
    function toast(msg){
      toastEl.textContent = msg;
      toastEl.classList.add("show");
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=> toastEl.classList.remove("show"), 1900);
    }

    // ===== Elements =====
    const startScreen = $("#startScreen");
    const startBtn = $("#startBtn");
    const fillDemoBtn = $("#fillDemoBtn");

    const modeSelect = $("#modeSelect");
    const starterSelect = $("#starterSelect");
    const aiSelect = $("#aiSelect");
    const p1NameInput = $("#p1Name");
    const p2NameInput = $("#p2Name");

    const subTitle = $("#subTitle");

    const cells = $$(".cell");
    const statusText = $("#statusText");
    const turnDot = $("#turnDot");
    const playersText = $("#playersText");

    const xWinsEl = $("#xWins");
    const oWinsEl = $("#oWins");
    const tiesEl  = $("#ties");
    const roundsEl = $("#rounds");

    const xLabel = $("#xLabel");
    const oLabel = $("#oLabel");
    const modeInfo = $("#modeInfo");
    const aiInfo = $("#aiInfo");
    const turnInfo = $("#turnInfo");

    const newRoundBtn = $("#newRoundBtn");
    const resetBtn = $("#resetBtn");
    const changeModeBtn = $("#changeModeBtn");
    const aiQuickBtn = $("#aiQuickBtn");
    const hintBtn = $("#hintBtn");

    // ===== Game State =====
    const winLines = [
      [0,1,2],[3,4,5],[6,7,8],
      [0,3,6],[1,4,7],[2,5,8],
      [0,4,8],[2,4,6]
    ];

    let settings = {
      mode: "single",      // "single" | "two"
      starter: "X",        // "X" | "O"
      aiLevel: "medium",   // "easy" | "medium" | "hard"
      p1: "Ù„Ø§Ø¹Ø¨ 1",
      p2: "Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±",
    };

    let score = { X:0, O:0, ties:0, rounds:0 };
    let board = Array(9).fill("");
    let current = "X";
    let gameOver = false;
    let started = false;

    function setStatus(text, color="var(--accent)"){
      statusText.textContent = text;
      turnDot.style.background = color;
      turnDot.style.boxShadow = `0 0 0 6px rgba(122,167,255,.10)`;
      turnInfo.textContent = text.replace("Ø¯ÙˆØ±", "Ø§Ù„Ø¯ÙˆØ±");
    }

    function renderLabels(){
      xLabel.textContent = `ÙÙˆØ² ${settings.p1} (X)`;
      oLabel.textContent = `ÙÙˆØ² ${settings.p2} (O)`;
      playersText.textContent = `${settings.p1} (X) â€¢ ${settings.p2} (O)`;
      subTitle.textContent = settings.mode === "single"
        ? "Ù„Ø§Ø¹Ø¨ ÙˆØ§Ø­Ø¯ Ø¶Ø¯ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± â€” Ø§Ø³ØªÙ…ØªØ¹!"
        : "Ù„Ø§Ø¹Ø¨ÙŠÙ† â€” ØªØ­Ø¯Ù‘Ù ØµØ¯ÙŠÙ‚Ùƒ!";
      modeInfo.textContent = settings.mode === "single" ? "Ù„Ø§Ø¹Ø¨ ÙˆØ§Ø­Ø¯ (Ø¶Ø¯ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±)" : "Ù„Ø§Ø¹Ø¨ÙŠÙ† (Ø¶Ø¯ Ù„Ø§Ø¹Ø¨)";
      aiInfo.textContent = (settings.mode === "single")
        ? (settings.aiLevel === "easy" ? "Ø³Ù‡Ù„" : settings.aiLevel === "medium" ? "Ù…ØªÙˆØ³Ø·" : "ØµØ¹Ø¨")
        : "ØºÙŠØ± Ù…ÙØ¹Ù‘Ù„ ÙÙŠ ÙˆØ¶Ø¹ Ù„Ø§Ø¹Ø¨ÙŠÙ†";
    }

    function render(){
      for(let i=0;i<9;i++){
        const v = board[i];
        cells[i].textContent = v;
        cells[i].classList.toggle("x", v==="X");
        cells[i].classList.toggle("o", v==="O");
        cells[i].disabled = !started || gameOver || v !== "";
      }

      xWinsEl.textContent = score.X;
      oWinsEl.textContent = score.O;
      tiesEl.textContent = score.ties;
      roundsEl.textContent = score.rounds;

      if(!started){
        setStatus("Ø§Ø¶ØºØ· ØªØºÙŠÙŠØ± Ø«Ù… Ø£Ø¯Ø®Ù„ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù…Ù† Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©", "var(--accent)");
        return;
      }

      if(!gameOver){
        const color = current === "X" ? "var(--x)" : "var(--o)";
        const name = current === "X" ? settings.p1 : settings.p2;
        setStatus(`Ø¯ÙˆØ±: ${name} (${current})`, color);
      }
    }

    function clearWinEffects(){
      cells.forEach(c => c.classList.remove("win"));
    }

    function checkWinner(b = board){
      for(const line of winLines){
        const [a,c,d] = line;
        if(b[a] && b[a] === b[c] && b[a] === b[d]){
          return { winner: b[a], line };
        }
      }
      if(b.every(x => x !== "")) return { winner: "tie", line: null };
      return null;
    }

    function endGame(result){
      gameOver = true;

      if(result.winner === "tie"){
        score.ties++;
        toast("ØªØ¹Ø§Ø¯Ù„ ğŸ¤");
        setStatus("Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬ÙˆÙ„Ø©: ØªØ¹Ø§Ø¯Ù„", "var(--accent)");
      }else{
        score[result.winner]++;
        const line = result.line || [];
        line.forEach(i => cells[i].classList.add("win"));

        const w = result.winner;
        const winnerName = w === "X" ? settings.p1 : settings.p2;
        const color = w === "X" ? "var(--x)" : "var(--o)";
        toast(`ÙØ§Ø² ${winnerName} ğŸ‰`);
        setStatus(`Ø§Ù„ÙØ§Ø¦Ø²: ${winnerName} (${w})`, color);
      }

      render();
    }

    function switchTurn(){
      current = current === "X" ? "O" : "X";
    }

    function validMoves(b = board){
      return b.map((v,i)=> v==="" ? i : null).filter(v=>v!==null);
    }

    // ===== AI =====
    function aiSymbol(){ return "O"; }     // AI plays O
    function humanSymbol(){ return "X"; }  // Human plays X in single mode

    function aiMoveEasy(){
      const moves = validMoves();
      return moves[Math.floor(Math.random()*moves.length)];
    }

    function aiMoveMedium(){
      const ai = aiSymbol();
      const hu = humanSymbol();
      const moves = validMoves();

      // win
      for(const m of moves){
        const b = board.slice();
        b[m] = ai;
        const res = checkWinner(b);
        if(res && res.winner === ai) return m;
      }
      // block
      for(const m of moves){
        const b = board.slice();
        b[m] = hu;
        const res = checkWinner(b);
        if(res && res.winner === hu) return m;
      }
      // center
      if(board[4] === "") return 4;
      return moves[Math.floor(Math.random()*moves.length)];
    }

    function minimax(b, isMax){
      const res = checkWinner(b);
      if(res){
        if(res.winner === aiSymbol()) return { score: 10 };
        if(res.winner === humanSymbol()) return { score: -10 };
        return { score: 0 };
      }
      const moves = validMoves(b);

      if(isMax){
        let best = { score: -Infinity, move: null };
        for(const m of moves){
          const nb = b.slice();
          nb[m] = aiSymbol();
          const r = minimax(nb, false);
          const val = r.score - 0.08;
          if(val > best.score) best = { score: val, move: m };
        }
        return best;
      }else{
        let best = { score: Infinity, move: null };
        for(const m of moves){
          const nb = b.slice();
          nb[m] = humanSymbol();
          const r = minimax(nb, true);
          const val = r.score + 0.08;
          if(val < best.score) best = { score: val, move: m };
        }
        return best;
      }
    }

    function aiMoveHard(){
      const best = minimax(board.slice(), true);
      return best.move ?? aiMoveMedium();
    }

    function computeAiMove(){
      if(settings.aiLevel === "easy") return aiMoveEasy();
      if(settings.aiLevel === "medium") return aiMoveMedium();
      return aiMoveHard();
    }

    function maybeAiTurn(){
      if(settings.mode !== "single") return;
      if(gameOver) return;
      if(current !== "O") return;

      // pause for "thinking"
      setStatus("Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± ÙŠÙÙƒØ±... ğŸ¤–", "var(--o)");
      cells.forEach(c => c.disabled = true);

      setTimeout(()=>{
        const move = computeAiMove();
        if(move == null) return;

        board[move] = "O";
        const res = checkWinner();
        if(res) endGame(res);
        else{
          switchTurn();
          render();
        }
      }, 520);
    }

    // ===== Gameplay =====
    function playAt(i){
      if(!started) return;
      if(gameOver) return;
      if(board[i] !== "") return;

      // In single mode, human must play only on X
      if(settings.mode === "single" && current !== "X") return;

      board[i] = current;
      const res = checkWinner();
      if(res){
        endGame(res);
        return;
      }

      switchTurn();
      render();
      maybeAiTurn();
    }

    cells.forEach(cell=>{
      cell.addEventListener("click", ()=>{
        const i = Number(cell.dataset.i);
        playAt(i);
      });
    });

    function newRound(){
      if(!started){
        toast("Ø§Ø¨Ø¯Ø£ Ù…Ù† Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹");
        startScreen.style.display = "flex";
        return;
      }
      clearWinEffects();
      board = Array(9).fill("");
      gameOver = false;
      score.rounds++;
      current = settings.starter;
      render();
      maybeAiTurn();
      toast("Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø© ğŸ®");
    }

    function resetAll(){
      clearWinEffects();
      board = Array(9).fill("");
      gameOver = false;
      score = { X:0, O:0, ties:0, rounds:0 };
      current = "X";
      started = false;
      renderLabels();
      render();
      toast("ØªÙ… Ø§Ù„ØªØµÙÙŠØ± âœ…");
      startScreen.style.display = "flex";
    }

    // ===== Start Screen =====
    function normalizeName(v, fallback){
      const name = (v || "").trim();
      return name.length ? name : fallback;
    }

    function startGameFromScreen(){
      settings.mode = modeSelect.value;
      settings.starter = starterSelect.value;
      settings.aiLevel = aiSelect.value;

      settings.p1 = normalizeName(p1NameInput.value, "Ù„Ø§Ø¹Ø¨ 1");
      settings.p2 = settings.mode === "single"
        ? "Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±"
        : normalizeName(p2NameInput.value, "Ù„Ø§Ø¹Ø¨ 2");

      // If two-player, ensure distinct names (not mandatory but nice)
      if(settings.mode === "two" && settings.p1 === settings.p2){
        settings.p2 = settings.p2 + " 2";
      }

      started = true;
      score.rounds = 1;
      board = Array(9).fill("");
      gameOver = false;
      current = settings.starter;

      startScreen.style.display = "none";
      renderLabels();
      render();
      maybeAiTurn();
      toast("Ø¨Ø¯Ø£Øª Ø§Ù„Ù„Ø¹Ø¨Ø©! Ø¨Ø§Ù„ØªÙˆÙÙŠÙ‚ âœ¨");
    }

    startBtn.addEventListener("click", startGameFromScreen);

    fillDemoBtn.addEventListener("click", ()=>{
      p1NameInput.value = "Ù†ÙˆØ§Ù";
      p2NameInput.value = "Ù…Ø­Ù…Ø¯";
      modeSelect.value = "two";
      starterSelect.value = "X";
      aiSelect.value = "medium";
      toast("ØªÙ…Øª Ø§Ù„ØªØ¹Ø¨Ø¦Ø© âœ¨");
    });

    modeSelect.addEventListener("change", ()=>{
      if(modeSelect.value === "single"){
        p2NameInput.value = "Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±";
        p2NameInput.disabled = true;
      }else{
        p2NameInput.disabled = false;
        if(p2NameInput.value.trim() === "Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±") p2NameInput.value = "";
      }
    });
    // init based on default
    modeSelect.dispatchEvent(new Event("change"));

    // ===== Header buttons =====
    newRoundBtn.addEventListener("click", ()=>{
      // If first round not started, start screen must be used
      if(!started){ startScreen.style.display = "flex"; toast("Ø§Ø¯Ø®Ù„ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø£ÙˆÙ„Ø§Ù‹"); return; }
      // do not double-count: if score.rounds already 0 or 1, still allow
      // We'll treat "Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©" as new round always
      // but if current round not started (score.rounds==1 and board empty) it still increments; acceptable for most projects.
      newRound();
    });

    resetBtn.addEventListener("click", resetAll);

    changeModeBtn.addEventListener("click", ()=>{
      startScreen.style.display = "flex";
      toast("ØºÙŠÙ‘Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø«Ù… Ø§Ø¶ØºØ· Ø§Ø¨Ø¯Ø£");
    });

    aiQuickBtn.addEventListener("click", ()=>{
      if(settings.mode !== "single"){
        toast("Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± ØºÙŠØ± Ù…ÙØ¹Ù‘Ù„ ÙÙŠ ÙˆØ¶Ø¹ Ù„Ø§Ø¹Ø¨ÙŠÙ†");
        return;
      }
      // cycle easy -> medium -> hard
      settings.aiLevel = (settings.aiLevel === "easy") ? "medium" : (settings.aiLevel === "medium") ? "hard" : "easy";
      aiInfo.textContent = settings.aiLevel === "easy" ? "Ø³Ù‡Ù„" : settings.aiLevel === "medium" ? "Ù…ØªÙˆØ³Ø·" : "ØµØ¹Ø¨";
      toast("ØªÙ… ØªØºÙŠÙŠØ± Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±");
    });

    hintBtn.addEventListener("click", ()=>{
      if(!started){ toast("Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø£ÙˆÙ„Ø§Ù‹"); return; }
      if(gameOver){ toast("Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù†ØªÙ‡Øª â€” Ø§Ø¨Ø¯Ø£ Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©"); return; }

      const moves = validMoves();
      if(moves.length === 0){ toast("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø±ÙƒØ§Øª"); return; }

      // Hint: suggest center if empty, else random available corner, else any move
      let suggested = null;
      const corners = [0,2,6,8].filter(i => board[i] === "");
      if(board[4] === "") suggested = 4;
      else if(corners.length) suggested = corners[Math.floor(Math.random()*corners.length)];
      else suggested = moves[Math.floor(Math.random()*moves.length)];

      toast(`ØªÙ„Ù…ÙŠØ­: Ø¬Ø±Ù‘Ø¨ Ø§Ù„Ø®Ø§Ù†Ø© Ø±Ù‚Ù… ${suggested + 1} âœ¨`);
    });

    // ===== Keyboard shortcuts =====
    document.addEventListener("keydown", (e)=>{
      const k = e.key.toLowerCase();
      if(k === "n") newRound();
      if(k === "r") resetAll();
      if(k === "escape") toastEl.classList.remove("show");
    });

    // ===== Initial render =====
    renderLabels();
    render();
  </script>
</body>
</html>